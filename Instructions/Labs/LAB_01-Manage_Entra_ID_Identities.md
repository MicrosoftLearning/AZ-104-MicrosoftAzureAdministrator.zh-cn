---
lab:
  title: 实验室 01：管理 Microsoft Entra ID 标识
  module: Administer Identity
---

# 实验室 01 - 管理 Microsoft Entra ID 标识

# 学生实验室手册

## 实验室方案

为了支持 Contoso 用户通过使用 Microsoft Entra ID 进行身份验证，你承担了预配用户和组账户的任务。 组的成员身份应根据用户职位自动更新。 你还需要创建具有测试用户帐户的测试租户，并向该帐户授予访问 Contoso Azure 订阅中资源的有限权限。

**注意：** 我们提供 **[交互式实验室模拟](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%201)** ，让你能以自己的节奏点击浏览实验室。 你可能会发现交互式模拟与托管实验室之间存在细微差异，但演示的核心概念和思想是相同的。

## 目标

在此实验中，将执行以下操作：

+ 任务 1：创建和配置用户
+ 任务 2：创建具有已分配和动态成员身份的组
+ 任务 3：创建租户（可选 - 实验室环境问题）
+ 任务 4：管理来宾用户（可选 - 实验室环境问题）

## 预计用时：30 分钟

## 体系结构关系图
![image](../media/lab01entra.png)

### 说明

## 练习 1

## 任务 1：创建和配置用户

在此任务中，你将创建和配置用户。

>**注意**：如果之前在此租户上使用过 Microsoft Entra ID 的试用版许可证，则需要创建新租户，并在该新租户中执行任务 3 后执行任务 2。

1. 登录 [Azure 门户](https://portal.azure.com)。

1. 在 Azure 门户中，搜索并选择“**Microsoft Entra ID**”。

1. 在 Microsoft Entra ID 边栏选项卡上，向下滚动到“**管理**”部分，单击“**用户设置**”，然后查看可用的配置选项。

1. 在 Microsoft Entra ID 边栏选项卡上的“**管理**”部分，单击“**用户**”，然后单击你的用户帐户以显示其“**个人资料**”设置。 

1. 单击“编辑属性”，然后在“设置”选项卡中，将“使用位置”设置为“美国”，然后单击“保存”以应用更改    。

    >**注意**：必须执行此操作，才能稍后在本实验室中将 Microsoft Entra ID P2 许可分配给用户帐户。

1. 导航回“用户 - 所有用户”边栏选项卡，然后单击“+ 新增用户” 。

1. 使用以下设置创建新用户（将其他设置保留为默认值）：

    | 设置 | 值 |
    | --- | --- |
    | 用户主体名称 | az104-01a-aaduser1 |
    | Display name | az104-01a-aaduser1 |
    | 自动生成密码 | 取消选择 |
    | 初始密码 | 提供安全密码 |
    | 职务（“属性”选项卡） | 云管理员 |
    | 部门（“属性”选项卡） | **IT** |
    | 使用位置（“属性”选项卡） | **美国** |

    >**注意**：将完整的“用户主体名称”（用户名加域）“复制到剪贴板”。 你将在此任务的后面部分使用它。

1. 在用户列表中，单击新创建的用户帐户以显示其边栏选项卡。

1. 查看“**管理**”部分的可用选项并注意，你可以标识分配给该用户帐户的角色以及该用户帐户对 Azure 资源的权限。

1. 在“管理”部分，单击“分配的角色”，然后单击“添加分配”按钮并分配“用户管理员”角色至“az104-01a-aaduser1”。

    >**注意**：预配新用户时，还可以选择分配角色。

1. 打开一个 InPrivate 浏览器窗口，并使用新创建的用户帐户登录到 [Azure 门户](https://portal.azure.com)。 当系统提示更新密码时，请将密码更改为所选的安全密码。 

    >**注意**：你可以粘贴剪贴板的内容，而不必输入用户名（包括域名）。

1. 在“**InPrivate**”浏览器窗口的 Azure 门户中，搜索并选择“**Microsoft Entra ID**”。

    >**注意**：尽管此用户帐户可以访问租户，但无权访问 Azure 资源。 这很正常，因为需要使用 Azure 基于角色的访问控制来明确授予对 Azure 资源的访问权限。 

1. 在“**InPrivate**”浏览器窗口的 Microsoft Entra ID 边栏选项卡上，向下滚动到“**管理**”部分，单击“**用户设置**”，请注意，你无权修改任何配置选项。

1. 在“**InPrivate**”浏览器窗口的 Microsoft Entra ID 边栏选项卡上，向下滚动到“**管理**”部分，单击“**用户**”，然后单击“ **+ 新建用户**”。

1. 使用以下设置创建新用户（将其他设置保留为默认值）：

    | 设置 | 值 |
    | --- | --- |
    | 用户主体名称 | az104-01a-aaduser2 |
    | Display name | az104-01a-aaduser2 |
    | 自动生成密码 | 取消选择  |
    | 初始密码 | **提供安全密码** |
    | 职务 | **系统管理员** |
    | 部门 | **IT** |
    | 使用位置 | **美国** |
    
1. 以 az104-01a-aaduser1 用户身份从 Azure 门户注销，并关闭 InPrivate 浏览器窗口。

## 任务 2：创建具有已分配和动态成员身份的组

在此任务中，你将创建具有已分配和动态成员身份的组。

1. 返回使用你的 **用户帐户** 登录的 Azure 门户，导航回到租户的“**概述**”边栏选项卡，然后在“**管理**”部分单击“**许可证**”。

    >**注意**：需要 Microsoft Entra ID Premium P1 或 P2 许可证才能实现动态组。

1. 在“管理”部分，单击“所有产品”。

1. 单击“ **+ 试用/购买**”并激活 Microsoft Entra ID Premium P2 免费试用版。

1. 刷新浏览器窗口，验证是否激活成功。 

    >**注意**：最多需要 10 分钟的时间，这些许可证才会激活。 继续刷新页面，直到许可证出现。 在许可证激活之前不要继续。

1. 在“许可证 - 所有产品”边栏选项卡，选择“Microsoft Entra ID P2”条目，然后将所有许可证选项分配给你的用户帐户和两个新创建的用户帐户 。

1. 在 Azure 门户中，导航回到“Microsoft Entra ID 租户”边栏选项卡，然后单击“**组**”。

1. 使用“+ 新建组”按钮创建一个新组，设置如下：

    | 设置 | 值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名称 | IT 云管理员 |
    | 组说明 | Contoso IT 云管理员 |
    | 成员身份类型 | 动态用户 |

    >**注意**：如果“成员身份类型”下拉列表显示为灰色，请等待几分钟，然后刷新浏览器页面。

1. 单击“添加动态查询”。

1. 在“动态成员资格规则”边栏选项卡的“配置规则”选项卡上，使用以下设置创建新规则 ：

    | 设置 | 值 |
    | --- | --- |
    | 属性 | **jobTitle** |
    | 操作员 | **等于** |
    | 值 | 云管理员 |

1. 通过依次单击“+添加表达式”和“保存”来保存规则 。 返回“新建组”边栏选项卡，单击“创建”。 

1. 返回租户的“**组 - 所有组**”边栏选项卡，单击“ **+ 新建组**”按钮，并使用以下设置创建新组：

    | 设置 | 值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名称 | IT 系统管理员 |
    | 组说明 | Contoso IT 系统管理员 |
    | 成员身份类型 | 动态用户 |

1. 单击“添加动态查询”。

1. 在“动态成员资格规则”边栏选项卡的“配置规则”选项卡上，使用以下设置创建新规则 ：

    | 设置 | 值 |
    | --- | --- |
    | 属性 | **jobTitle** |
    | 操作员 | **等于** |
    | 值 | **系统管理员** |

1. 通过依次单击“+添加表达式”和“保存”来保存规则 。 返回“新建组”边栏选项卡，单击“创建”。 

1. 返回租户的“**组 - 所有组**”边栏选项卡，单击“ **+ 新建组**”按钮，并使用以下设置创建新组：

    | 设置 | 值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名称 | IT 实验室管理员 |
    | 组说明 | Contoso IT 实验室管理员 |
    | 成员身份类型 | **已分配** |
    
1. 请单击“未选定成员”。

1. 在“添加成员”边栏选项卡，搜索并选择“IT 云管理员”和“IT 系统管理员”组，然后回到“新组”边栏选项卡，单击“创建”。

1. 回到“组 - 所有组”边栏选项卡，单击代表“IT 云管理员”组的条目，然后显示其“成员”边栏选项卡。 验证 az104-01a-aaduser1 出现在组成员列表中。

    >**注意**：可能会遇到动态成员身份组更新导致的延迟。 为加速更新，请导航至组边栏选项卡，并显示其“动态成员资格规则”边栏选项卡，编辑“规则语法”文本框中列出的规则（在末尾添加一个空格），然后保存更改   。

1. 导航回“组”-“所有组”边栏选项卡，单击代表“IT 系统管理员”组的条目，然后显示其“成员”边栏选项卡  。 验证 az104-01a-aaduser2 出现在组成员列表中。

## 任务 3：创建租户（可选 - 可能存在验证码问题，需要付费订阅）

在此任务中，你将创建新的租户。
    
1. 在 Azure 门户中，搜索并选择“**Microsoft Entra ID**”。

    >**注意**：实验室环境中的 Captcha 验证存在一个已知问题。 如果收到错误“创建失败。请求过多，请稍后尝试”，请执行以下操作：
    - 尝试创建几次。<br>
    - 检查“管理租户”部分，确保未在后台创建租户。 <br>
    - 打开一个新的 InPrivate 窗口，并使用 Azure 门户尝试从那里创建租户。<br>
     向培训师提出问题，然后使用[交互式实验室模拟](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%201)查看步骤。 <br>
    - 可以稍后尝试此任务，但其他实验室不需要创建租户。 

1. 单击“管理租户”，然后在下一个屏幕上单击“+ 创建”，并指定以下设置 ：

    | 设置 | 值 |
    | --- | --- |
    | 目录类型 | **Microsoft Entra ID** |
    
1. 单击“下一步: 配置”

    | 设置 | 值 |
    | --- | --- |
    | 组织名称 | Contoso 实验室 |
    | 初始域名 | 由小写字母和数字组成并以字母开头的任何有效 DNS 名称 | 
    | 国家/地区 | **美国** |

   > **注意**：初始域名不应是可能与你的组织或其他组织的名称相冲突的合法名称。 “初始域名”文本框中出现绿色复选标记，表示你键入的域名有效且具有唯一性。

1. 依次单击“查看 + 创建”、“创建”。

1. 显示新创建的租户的边栏选项卡，方法是使用“**单击此处以导航到新租户: Contoso 实验室**”链接或 Azure 门户工具栏中的“**目录 + 订阅**”按钮（紧邻“Cloud Shell”按钮的右侧）。

## 任务 4：管理来宾用户。

在此任务中，你将创建来宾用户，并授予他们访问 Azure 订阅中资源的权限。

1. 在显示 Contoso 实验室租户的 Azure 门户中，在“**管理**”部分，单击“**用户**”，然后单击“ **+ 新建用户**”。

1. 使用以下设置创建新用户（将其他设置保留为默认值）：

    | 设置 | 值 |
    | --- | --- |
    | 用户主体名称 | az104-01b-aaduser1 |
    | Display name | az104-01b-aaduser1 |
    | 自动生成密码 | 取消选择  |
    | 初始密码 | **提供安全密码** |
    | 职务 | **系统管理员** |
    | 部门 | **IT** |

1. 单击新建的个人资料。

    >**注意**：将完整的“用户主体名称”（用户名加域）“复制到剪贴板”。 你将在此任务的后面部分使用它。

1. 返回到之前创建的第一个租户。
2. 选择导航窗格中的**概览**。
3. 单击“管理租户”。****
4. 选中此前创建的第一个租户旁边的框，然后选择“切换”****。

1. 导航回“用户 - 所有用户”边栏选项卡，然后单击“+ 邀请外部用户”。

1. 使用以下设置邀请新的来宾用户（其他设置保留默认值）：

    | 设置 | 值 |
    | --- | --- |
    | 电子邮件 | 你之前在此任务中复制的用户主体名称 |
    | 显示名称（“属性”选项卡）  | az104-01b-aaduser1 |
    | 职务（“属性”选项卡） | 实验室管理员 |
    | 部门（“属性”选项卡） | **IT** |
    | 使用位置（“属性”选项卡） | **美国** |

1. 单击“邀请”。 

1. 回到“用户 - 所有用户”边栏选项卡，单击表示新创建的来宾用户帐户的条目。

1. 在“az104-01b-aaduser1 - 配置文件”边栏选项卡上，单击“组” 。

1. 请单击“+ 添加成员身份”并将来宾用户帐户添加到“IT 实验室管理员”组。


## 任务 5：清理资源

> **注意**：记得删除所有不再使用的新建 Azure 资源。 删除未使用的资源，确保不产生意外成本。 在这种情况下，虽然没有与租户及其对象相关的额外费用，但你可能需要考虑删移除在此实验室中创建的用户帐户、组帐户和租户。

 > **注意**：如果不能立即删除实验室资源，也不要担心。 有时资源具有依赖项，需要更长的时间才能删除。 这是监视资源使用情况的常见管理员任务，因此，只需定期查看门户中的资源即可查看清理方式。 

1. 在 **Azure 门户** 中的搜索栏中搜索 **Microsoft Entra ID**。 在“**管理**”下选择“**许可证**”。 转到“**管理**”下的“**许可证**”后，选择“**所有产品**”，然后在列表中选择“**Microsoft Entra ID Premium P2**”项。 然后选择“许可的用户”以继续。 选择在本实验室中为其分配了许可证的用户帐户 az104-01a-aaduser1 和 az104-01a-aaduser2，单击“删除许可证”，然后在系统提示确认时单击“是”   。

1. 在 Azure 门户中，导航到“用户 - 所有用户”边栏选项卡，单击代表 az104-01b-aaduser1 来宾用户帐户的条目，在“az104-01b-aaduser1 - 个人资料”边栏选项卡上，单击“删除”，然后在系统提示确认时，单击“确定”。

1. 重复相同的步骤序列，删除你在本实验室创建的其余用户帐户。

1. 导航到“组 - 所有组”边栏选项卡，选择你在本实验室中创建的组，单击“删除”，然后在提示确认时，单击“确定”。

1. 在 Azure 门户中，使用 Azure 门户工具栏中的“**目录 + 订阅**”按钮（紧邻“Cloud Shell”按钮右侧）来显示 Contoso 实验室租户的边栏选项卡。

1. 导航回到“用户 - 所有用户”边栏选项卡，单击代表“az104-01b-aaduser1”用户帐户的条目，在“az104-01b-aaduser1 - 配置文件”边栏选项卡上单击“删除”，然后在提示确认时单击“确定”。

1. 导航到 Contoso 实验室租户的“**Contoso 实验室 - 概述**”边栏选项卡，单击“**管理租户**”，然后在下一个屏幕上选择“**Contoso 实验室**”旁边的框，在“**是否删除租户‘Contoso 实验室’?** ”边栏选项上单击“**删除**” 单击“**获取删除 Azure 资源的权限**”链接，然后在“**属性**”边栏选项卡上，将“**Azure 资源访问管理**”设置为“**是**”，并单击“**保存**”。

1. 导航回“删除目录‘Contoso 实验室’”边栏选项卡，然后依次单击“刷新”和“删除”  。

> **注意**：如果租户具有试用版许可证，则必须先等待试用版许可证过期，然后才能删除租户。 这不会产生任何额外费用。

#### 审阅

在此实验室中，你执行了以下操作：

- 创建和配置了用户
- 创建了具有已分配和动态成员身份的组
- 创建了租户
- 管理了来宾用户 
