---
lab:
    title: '03b - 使用 ARM 模板管理 Azure 资源'
    module: '模块 03 - Azure 管理'
---

# 实验室 03b - 使用 ARM 模板管理 Azure 资源
# 学生实验室手册

## 实验室场景
你已探索了与使用 Azure 门户预配资源并根据资源组整理资源相关的基本 Azure 管理功能，现在你需要使用 Azure 资源管理器模板来执行等效的任务

## 目标

在本实验室中，你将：

+ 任务 1：查看用于部署 Azure 托管磁盘的 ARM 模板
+ 任务 2： 使用 ARM 模板创建 Azure 托管磁盘
+ 任务 3：查看基于 ARM 模板的托管磁盘部署

## 预计用时：20 分钟

## 体系结构图

![图像](../media/lab03b.png)

## 说明

### 练习 1

#### 任务 1：查看用于部署 Azure 托管磁盘的 ARM 模板

在此任务中，你将使用一个 Azure 资源管理器模板创建一个 Azure 磁盘资源。

1. 登录到 [**Azure 门户**](https://portal.azure.com)。

1. 在 Azure 门户中，搜索并选择 **“资源组”**。 

1. 在资源组列表中，单击 **“az104-03a-rg1”**。

1. 在 **“az104-03a-rg1”** 资源组边栏选项卡中的 **“设置”** 部分，单击 **“部署”**。

1. 在 **“az104-03a-rg1 - 部署”** 边栏选项卡上，单击部署列表中的第一个条目。

1. 在 **“Microsoft.ManagedDisk-*XXXXXXXXX* \| 概述”** 边栏选项卡上，单击 **“模板”**。

    >**备注**：查看模板内容，请注意，你可以选择将其**下载**到本地计算机、**添加到库中**，或重新**部署**。

1. 单击 **“下载”** 并将包含模板和参数文件的压缩文件保存到实验室计算机上的 **“下载”** 文件夹。

1. 在 **“Microsoft.ManagedDisk-*XXXXXXXXX* \| 模板”** 边栏选项卡上，单击 **“输入”**。

1. 请记下 **“位置”** 参数的值。在下一个任务中需要使用它。

1. 将下载文件的内容提取到实验室计算机上的 **“下载”** 文件夹。

    >**备注**：这些文件也可以是 **\\Allfiles\\Labs\\03\\az104-03b-md-template.json** 和 **\\Allfiles\\Labs\\03\\az104-03b-md-parameters.json**
    
1. 关闭所有 **“文件资源管理器”** 窗口。

#### 任务 2：使用 ARM 模板创建 Azure 托管磁盘

1. 在 Azure 门户中，搜索并选择 **“部署自定义模板”**。

1. 单击 **“市场”** 组下的 **“模板部署(使用自定义模板进行部署)”**。

1. 在 **“自定义部署”** 边栏选项卡上，单击 **“在编辑器中构建自己的模板”**。

1. 在 **“编辑模版”** 边栏选项卡上，单击 **“加载文件”** 并上传你在上一个任务中下载的 **template.json** 文件。

1. 在编辑器窗格中，移除以下行：

   ```json
   "sourceResourceId": {
       "type": "String"
   },
   "sourceUri": {
       "type": "String"
   },
   "sourceImageVersionId": {
       "type": "String"
   },
   "osType": {
       "type": "String"
   },
   ```

   ```json
   "hyperVGeneration": {
       "defaultValue": "V1",
       "type": "String"
   },      
   ```

   ```json
   "osType": "[parameters('osType')]",
   ```

    >**备注**：由于这些参数不适用于当前部署，因此将其移除。sourceResourceId、sourceUri、osType 和 hyperVGeneration 参数尤其适用于根据现有 VHD 文件创建 Azure 磁盘。

1. **保存**更改。

1. 返回 **“自定义部署”** 边栏选项卡，单击 **“编辑参数”**。 

1. 在 **“编辑模版”** 边栏选项卡上，单击 **“加载文件”** 并上传你在上一个任务中下载的 **parameters.json** 文件，然后**保存**更改。

1. 返回 **“自定义部署”** 边栏选项卡，指定以下设置：

    | 设置 | 值 |
    | --- |--- |
    | 订阅 | *在本实验室中使用的 Azure 订阅的名称* |
    | 资源组 | **新建**资源组的名称 **az104-03b-rg1** |
    | 区域 | 本实验室所用订阅中可用的任何 Azure 区域的名称 |
    | 磁盘名称 | **az104-03b-disk1** |
    | 位置 | 在上一任务中记下的位置参数值 |
    | SKU | **Standard_LRS** |
    | 磁盘大小 (Gb) | **32** |
    | 创建选项 | **empty** |
    | 磁盘加密集类型 | **EncryptionAtRestWithPlatformKey** |
    | 网络访问策略 | **AllowAll** |

1. 选择 **“查看 + 创建”**，然后选择 **“创建”**。

1. 验证部署是否成功完成。

#### 任务 3：查看基于 ARM 模板的托管磁盘部署

1. 在 Azure 门户中，搜索并选择 **“资源组”**。 

1. 在资源组列表中，单击 **“az104-03b-rg1”**。

1. 在 **“az104-03b-rg1”** 资源组边栏选项卡的 **“设置”** 部分，单击 **“部署”**。

1. 在 **“az104-03b-rg1 - 部署”** 边栏选项卡上，单击部署列表中的第一个条目，然后查看 **“输入”** 和 **“模板”** 边栏选项卡的内容。

#### 清理资源

   >**备注**：不要删除你在本实验室中部署的资源。在本模块的下一个实验室中，你将引用它们。

#### 回顾

在本实验室中，你已：

- 查看用于部署 Azure 托管磁盘的 ARM 模板
- 使用 ARM 模板创建一个 Azure 托管磁盘
- 查看基于 ARM 模板的托管磁盘部署
